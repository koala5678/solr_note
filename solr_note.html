<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-01-03 二 12:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta name="generator" content="Org mode" />
<meta name="author" content="吴丹阳" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgaafed1e">1. Quick Start</a>
<ul>
<li><a href="#orga64b599">1.1. Prerequisite</a>
<ul>
<li><a href="#org202c278">1.1.1. Java Run Environment(JRE)</a></li>
</ul>
</li>
<li><a href="#orgf4de777">1.2. Installing Solr</a></li>
<li><a href="#orgdec52a8">1.3. Running Solr</a></li>
<li><a href="#orge254cc6">1.4. Create a Core(Collection if on Cloud)</a></li>
<li><a href="#org6cb240d">1.5. Add Document</a></li>
<li><a href="#orgc677444">1.6. Ask Question</a></li>
</ul>
</li>
<li><a href="#org9ce1fe3">2. Using the Solr Administration User Interface</a>
<ul>
<li><a href="#org4268316">2.1. 访问</a></li>
<li><a href="#orgbf3fa8c">2.2. 获取帮助</a></li>
<li><a href="#orgd6fde45">2.3. Logging</a></li>
<li><a href="#org1190400">2.4. Cloud</a>
<ul>
<li><a href="#org38ea68e">2.4.1. Tree</a></li>
<li><a href="#org40cd430">2.4.2. graph</a></li>
<li><a href="#orge6a921f">2.4.3. Dump</a></li>
</ul>
</li>
<li><a href="#orgee8416e">2.5. Collections / Core Admin</a></li>
<li><a href="#org55becfd">2.6. Thread Dump</a></li>
<li><a href="#org9160ac1">2.7. Collection-Specific Tools(只有在cloud下才能看到)</a>
<ul>
<li><a href="#orgfead205">2.7.1. Analysis</a></li>
<li><a href="#org3e0c3c3">2.7.2. Documents</a></li>
<li><a href="#org469eff7">2.7.3. Files</a></li>
<li><a href="#org53f2ca4">2.7.4. Stream</a></li>
<li><a href="#org41a0780">2.7.5. Schema</a></li>
</ul>
</li>
<li><a href="#orgcbac142">2.8. Core-Specific Tools</a>
<ul>
<li><a href="#org80ccad2">2.8.1. Ping</a></li>
<li><a href="#org25d100b">2.8.2. Segment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfcf4aa6">3. Documents, Fields, and Schema Design</a>
<ul>
<li><a href="#org586601e">3.1. Overview</a>
<ul>
<li><a href="#orgcfee6e1">3.1.1. 原理简介</a></li>
<li><a href="#org0dee4e6">3.1.2. Field Analysis</a></li>
<li><a href="#orgf792681">3.1.3. Schema File</a></li>
</ul>
</li>
<li><a href="#orge3131c6">3.2. Schema Detail</a>
<ul>
<li><a href="#orgee8eb8f">3.2.1. Solr Field Types</a></li>
<li><a href="#orga550b71">3.2.2. Defining Fields</a></li>
<li><a href="#orga30e545">3.2.3. Copying Fields</a></li>
<li><a href="#org0d242ee">3.2.4. Dynamic Fields</a></li>
<li><a href="#orga7964a7">3.2.5. Other Elements</a></li>
<li><a href="#orgecc5c20">3.2.6. Schema API</a></li>
<li><a href="#orgf04c763">3.2.7. Putting the Pieces Together</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdb08e04">4. <span class="todo TODO">TODO</span> Using Analyzers, Tokenizers, and Filters</a>
<ul>
<li><a href="#org42f93b0">4.1. </a></li>
</ul>
</li>
<li><a href="#org4c0f96a">5. Indexing and Basic Data Operations</a>
<ul>
<li><a href="#org7274738">5.1. Post Tool</a>
<ul>
<li><a href="#org50b7a0e">5.1.1. bin/post</a></li>
<li><a href="#org30d39e9">5.1.2. SimplePostTool</a></li>
</ul>
</li>
<li><a href="#orgb2806b7">5.2. Uploading Data with Index Handlers</a></li>
<li><a href="#org92dbbe2">5.3. <span class="todo TODO">TODO</span> Uploading Data with Solr Cell using Apache Tika</a></li>
</ul>
</li>
<li><a href="#org88e9a32">6. Search</a>
<ul>
<li><a href="#org43d93f8">6.1. Overview</a>
<ul>
<li><a href="#org2c99950">6.1.1. 输入查询语句</a></li>
<li><a href="#org1ad3370">6.1.2. 查询语句被 <b>request handler</b> 处理 (此插件定义了solr处理请求的逻辑)</a></li>
<li><a href="#org45a630e">6.1.3. 调用 <b>query parser</b> (解析器解释查询的条件和参数)</a></li>
<li><a href="#org333702d">6.1.4. *filter query*(fq) (filter query 会开辟一块单独的缓存，这种策略对性能提升很大)</a></li>
<li><a href="#org5be3da3">6.1.5. 指定特定的条件高亮</a></li>
<li><a href="#orgdb58c1d">6.1.6. 返回结果可以有一个小片段，像是谷歌的搜索</a></li>
<li><a href="#org15ebb5f">6.1.7. 对结果分组</a></li>
<li><a href="#org9b49b59">6.1.8. MoreLikeThis</a></li>
<li><a href="#org835c411">6.1.9. response writer (返回结果的形式)</a></li>
</ul>
</li>
<li><a href="#org661dd3d">6.2. 通用查询语句</a>
<ul>
<li><a href="#org18b6ec7">6.2.1. defType:</a></li>
<li><a href="#org4950cbf">6.2.2. sort:</a></li>
<li><a href="#org436cf56">6.2.3. start:</a></li>
<li><a href="#org5edd57c">6.2.4. rows:</a></li>
<li><a href="#orgdbfec52">6.2.5. fq:</a></li>
<li><a href="#org5dcae54">6.2.6. fl:</a></li>
<li><a href="#org81867fe">6.2.7. debug:</a></li>
<li><a href="#orgcec2543">6.2.8. explainOther:</a></li>
<li><a href="#orgb3657d2">6.2.9. timeAllowed：</a></li>
<li><a href="#orgc0af135">6.2.10. omitHeader:</a></li>
<li><a href="#orgca7c8ca">6.2.11. wt:</a></li>
<li><a href="#org0a413a3">6.2.12. cache=false:</a></li>
<li><a href="#org86a050d">6.2.13. logParamsList(version &gt;= 4.7):</a></li>
<li><a href="#org8e275c5">6.2.14. echoParams:</a></li>
</ul>
</li>
<li><a href="#orge30e834">6.3. The Standard Query Parser (lucene parser)</a>
<ul>
<li><a href="#orga163d40">6.3.1. q</a></li>
<li><a href="#orgaa5a506">6.3.2. q.op</a></li>
<li><a href="#org594fca4">6.3.3. df</a></li>
</ul>
</li>
<li><a href="#orge9a31ae">6.4. <span class="todo TODO">TODO</span> The DisMax Query Parser</a>
<ul>
<li><a href="#org8f5f848">6.4.1. Parameters</a></li>
</ul>
</li>
<li><a href="#org09fb0f3">6.5. Faceting</a>
<ul>
<li><a href="#orga0cab40">6.5.1. General Parameters</a></li>
<li><a href="#org2f02342">6.5.2. Field-Value Faceting Parameters</a></li>
<li><a href="#orga3c36c5">6.5.3. facet.pivot</a></li>
</ul>
</li>
<li><a href="#org5cf2d00">6.6. Highlighter</a>
<ul>
<li><a href="#org922ac84">6.6.1. Standard Highlighter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc96926b">7. solrCloud</a>
<ul>
<li><a href="#org1ed3883">7.1. features</a></li>
<li><a href="#org101c5f9">7.2. 相关概念</a>
<ul>
<li><a href="#orgb2f4d7b">7.2.1. Node</a></li>
<li><a href="#orgc324123">7.2.2. Cluster</a></li>
<li><a href="#orgc11ed11">7.2.3. Collection</a></li>
<li><a href="#org594bb1a">7.2.4. Config Set</a></li>
<li><a href="#orgfb7c6e0">7.2.5. Leader</a></li>
<li><a href="#org60dc663">7.2.6. Replica</a></li>
<li><a href="#org50d0361">7.2.7. Shard</a></li>
<li><a href="#org3f0942b">7.2.8. Zookeeper</a></li>
</ul>
</li>
<li><a href="#orgdfa5fcf">7.3. 配置外部 ZooKeeper</a>
<ul>
<li><a href="#org511df27">7.3.1. 一个实例</a></li>
<li><a href="#org1528651">7.3.2. 集群</a></li>
<li><a href="#org75fd3de">7.3.3. 通过zookeeper管理配置文件</a></li>
<li><a href="#org145975c">7.3.4. 添加 node</a></li>
<li><a href="#org23bedd8">7.3.5. Collections API</a></li>
</ul>
</li>
<li><a href="#orgd8aaee9">7.4. Run Examples</a>
<ul>
<li><a href="#org8dd1dad">7.4.1. 通过 bin/solr restart 可以重启节点</a></li>
<li><a href="#org8ebc343">7.4.2. 向集群中添加一个节点</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbc9d535">8. Issues</a>
<ul>
<li><a href="#org8fc5077">8.1. 学习时遇到的问题</a>
<ul>
<li><a href="#orgad254c7">8.1.1. Q: ZooKeeper JMX enabled by default Using config: <i>Users/wudanyang/self/zoo/bin</i>../conf/zoo.cfg Error contacting service. It is probably not running.</a></li>
<li><a href="#org53ec5ed">8.1.2. Q: ZooKeeper 执行 bin/zkServer.sh status 说未启动</a></li>
<li><a href="#orgfe8ea84">8.1.3. Q: SolrCore Initialization Failures</a></li>
<li><a href="#org3560082">8.1.4. Q: 通过api创建collection时, 返回localhost未返回任何数据</a></li>
<li><a href="#org27f7592">8.1.5. Q: Cannot create collection tinycollection. Value of maxShardsPerNode is 1, and the number of live nodes is 4. This allows a maximum of 4 to be created. Value of numShards is 2 and value of replicationFactor is 3. This requires 6 shards to be created (higher than the allowed number)&lt;/str&gt;</a></li>
<li><a href="#orgc42c125">8.1.6. Q: 在zookeeper中找不到配置文件</a></li>
<li><a href="#org9f556b4">8.1.7. Q: 为何在6.*以上的solr中store=false 仍然能看到字段被返回了</a></li>
<li><a href="#orgf3cbae5">8.1.8. Q: int类型为何docValues=false与stored=false还能在结果中看到字段</a></li>
<li><a href="#org234a5a1">8.1.9. Q: 从 example/example-DIH/solr/ 中复制solr.xml 作为cloud的配置文件无法生效</a></li>
<li><a href="#org725abc7">8.1.10. Q: 为什么找不到 Can't find resource 'schema.xml'</a></li>
</ul>
</li>
<li><a href="#orgcb38411">8.2. 公司系统发现的问题</a></li>
</ul>
</li>
<li><a href="#org95ef5d3">9. Cache</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgaafed1e" class="outline-2">
<h2 id="orgaafed1e"><span class="section-number-2">1</span> Quick Start</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orga64b599" class="outline-3">
<h3 id="orga64b599"><span class="section-number-3">1.1</span> Prerequisite</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-org202c278" class="outline-4">
<h4 id="org202c278"><span class="section-number-4">1.1.1</span> Java Run Environment(JRE)</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>version &gt;= 1.8</li>
</ul>
<div class="org-src-container">
<pre class="src src-shell">java -version
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgf4de777" class="outline-3">
<h3 id="orgf4de777"><span class="section-number-3">1.2</span> Installing Solr</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-sh">wget http://lucene.apache.org/solr/
<span style="color: #e5786d;">cd</span> /path/to/solr_arch
tar zxf solr-x.y.z.tgz
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdec52a8" class="outline-3">
<h3 id="orgdec52a8"><span class="section-number-3">1.3</span> Running Solr</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-sh">bin/solr start
bin/solr -help
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#25351;&#23450;&#21629;&#20196;&#30340;&#24110;&#21161;&#25991;&#26723;</span>
bin/solr start -help

<span style="color: #99968b;"># </span><span style="color: #99968b;">&#21069;&#31471;&#24320;&#21551;Foreground</span>
bin/solr start -f
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#25351;&#23450;&#31471;&#21475; (&#40664;&#35748;&#26159;8983)</span>
bin/solr start -p <span style="color: #e5786d;">8984</span>
bin/solr stop <span style="color: #8c8c8c;">[</span>-p <span style="color: #e5786d;">8983</span> | -all<span style="color: #8c8c8c;">]</span>

<span style="color: #99968b;"># </span><span style="color: #99968b;">&#21551;&#21160;&#31034;&#20363;</span>
bin/solr -e techproducts <span style="color: #8c8c8c;">[</span>techproducts, dih, schemaless, and cloud.<span style="color: #8c8c8c;">]</span>

bin/solr status
</pre>
</div>

<p>
➜  solr bin/solr -e techproducts
</p>
<div class="org-src-container">
<pre class="src src-sh">&#10140;  solr bin/solr -e techproducts
Solr home directory /Users/wudanyang/self/solr/example/techproducts/solr already exists.

Starting up Solr on port <span style="color: #e5786d;">8983</span> using command:
bin/solr start -p <span style="color: #e5786d;">8983</span> -s <span style="color: #95e454;">"example/techproducts/solr"</span>

Archiving <span style="color: #e5786d;">1</span> old GC log files to /Users/wudanyang/self/solr/example/techproducts/solr/../logs/archived
Archiving <span style="color: #e5786d;">1</span> console log files to /Users/wudanyang/self/solr/example/techproducts/solr/../logs/archived
Rotating solr logs, keeping a max of <span style="color: #e5786d;">9</span> generations
Waiting up to <span style="color: #e5786d;">180</span> seconds to see Solr running on port <span style="color: #e5786d;">8983</span> <span style="color: #8c8c8c;">[</span><span style="color: #95e454;">\</span><span style="color: #8c8c8c;">]</span>
Started Solr server on port <span style="color: #e5786d;">8983</span> <span style="color: #8c8c8c;">(</span><span style="color: #cae682;">pid</span>=<span style="color: #e5786d;">28473</span><span style="color: #8c8c8c;">)</span>. Happy searching!


Copying configuration to new core instance directory:
/Users/wudanyang/self/solr/example/techproducts/solr/techproducts

Creating new core <span style="color: #95e454;">'techproducts'</span> using command:
http://localhost:8983/solr/admin/cores?<span style="color: #cae682;">action</span>=CREATE&amp;<span style="color: #cae682;">name</span>=techproducts&amp;<span style="color: #cae682;">instanceDir</span>=techproducts

<span style="color: #8c8c8c;">{</span>
  <span style="color: #95e454;">"responseHeader"</span>:<span style="color: #93a8c6;">{</span>
    <span style="color: #95e454;">"status"</span>:0,
    <span style="color: #95e454;">"QTime"</span>:2036<span style="color: #93a8c6;">}</span>,
  <span style="color: #95e454;">"core"</span>:<span style="color: #95e454;">"techproducts"</span><span style="color: #8c8c8c;">}</span>


Indexing tech product example docs from /Users/wudanyang/self/solr/example/exampledocs
SimplePostTool version <span style="color: #e5786d;">5.0.0</span>
Posting files to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span> url http://localhost:8983/solr/techproducts/update using content-type application/xml...
POSTing file gb18030-example.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file hd.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file ipod_other.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file ipod_video.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file manufacturers.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file mem.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file money.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file monitor.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file monitor2.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file mp500.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file sd500.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file solr.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file utf8-example.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
POSTing file vidcard.xml to <span style="color: #8c8c8c;">[</span>base<span style="color: #8c8c8c;">]</span>
<span style="color: #e5786d;">14</span> files indexed.
COMMITting Solr index changes to http://localhost:8983/solr/techproducts/update...
Time spent: <span style="color: #e5786d;">0:00:00.601</span>

Solr techproducts example launched successfully. Direct your Web browser to http://localhost:8983/solr to visit the Solr Admin UI
</pre>
</div>
</div>
</div>


<div id="outline-container-orge254cc6" class="outline-3">
<h3 id="orge254cc6"><span class="section-number-3">1.4</span> Create a Core(Collection if on Cloud)</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>上面运行的是示例文件,创建自己Core用来索引和搜索文档</li>
<li>Core与Solr的关系跟软件与操作系统关系相似</li>
<li>每个core有自身的配置文件及数据</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">bin/solr create -c &lt;name&gt;
bin/solr create -help
</pre>
</div>
<div class="org-src-container">
<pre class="src src-sh">&#10140;  solr bin/solr create -help
Usage: solr create <span style="color: #8c8c8c;">[</span>-c name<span style="color: #8c8c8c;">]</span> <span style="color: #8c8c8c;">[</span>-d confdir<span style="color: #8c8c8c;">]</span> <span style="color: #8c8c8c;">[</span>-n configName<span style="color: #8c8c8c;">]</span> <span style="color: #8c8c8c;">[</span>-shards <span style="color: #95e454;">\#</span>] [-replicationFactor <span style="color: #95e454;">\#</span>] [-p port]
  Create a core or collection depending on whether Solr is running<span style="color: #8ac6f2; font-weight: bold;"> in</span> standalone <span style="color: #93a8c6;">(</span>core<span style="color: #93a8c6;">)</span> or SolrCloud
  mode <span style="color: #93a8c6;">(</span>collection<span style="color: #93a8c6;">)</span>. In other words, this action detects which mode Solr is running<span style="color: #8ac6f2; font-weight: bold;"> in</span>, and then takes
  the appropriate action <span style="color: #93a8c6;">(</span>either create_core or create_collection<span style="color: #93a8c6;">)</span>.
</pre>
</div>
</div>
</div>


<div id="outline-container-org6cb240d" class="outline-3">
<h3 id="org6cb240d"><span class="section-number-3">1.5</span> Add Document</h3>
<div class="outline-text-3" id="text-1-5">
<p>
schema 决定了文档的结构
</p>
<div class="org-src-container">
<pre class="src src-sh">&#10140;  solr bin/post -help

Usage: post -c &lt;collection&gt; <span style="color: #8c8c8c;">[</span>OPTIONS<span style="color: #8c8c8c;">]</span> &lt;files|directories|urls|-d <span style="color: #8c8c8c;">[</span><span style="color: #95e454;">"..."</span>,...<span style="color: #8c8c8c;">]</span>&gt;
    or post -help

  collection name defaults to DEFAULT_SOLR_COLLECTION if not specified

OPTIONS
=======
  Solr options:
    -url &lt;base Solr update URL&gt; <span style="color: #8c8c8c;">(</span>overrides<span style="color: #93a8c6;">[</span>&#21253;&#25324;<span style="color: #93a8c6;">]</span> collection, host, and port<span style="color: #8c8c8c;">)</span>
    -host &lt;host&gt; <span style="color: #8c8c8c;">(</span>default: localhost<span style="color: #8c8c8c;">)</span>
    -p or -port &lt;port&gt; <span style="color: #8c8c8c;">(</span>default: <span style="color: #e5786d;">8983</span><span style="color: #8c8c8c;">)</span>
    -commit yes|no <span style="color: #8c8c8c;">(</span>default: yes<span style="color: #8c8c8c;">)</span>
    -u or -user &lt;user:pass&gt; <span style="color: #8c8c8c;">(</span>sets BasicAuth credentials<span style="color: #8c8c8c;">)</span>

  Web crawl options:
    -recursive &lt;depth&gt; <span style="color: #8c8c8c;">(</span>default: <span style="color: #e5786d;">1</span><span style="color: #8c8c8c;">)</span>
    -delay &lt;seconds&gt; <span style="color: #8c8c8c;">(</span>default: <span style="color: #e5786d;">10</span><span style="color: #8c8c8c;">)</span>

  Directory crawl options:
    -delay &lt;seconds&gt; <span style="color: #8c8c8c;">(</span>default: <span style="color: #e5786d;">0</span><span style="color: #8c8c8c;">)</span>

  stdin/args options:
    -type &lt;content/type&gt; <span style="color: #8c8c8c;">(</span>default: application/xml<span style="color: #8c8c8c;">)</span>

  Other options:
    -filetypes &lt;type&gt;<span style="color: #8c8c8c;">[</span>,&lt;type&gt;,...<span style="color: #8c8c8c;">]</span> <span style="color: #8c8c8c;">(</span>default: xml,json,jsonl,csv,pdf,doc,docx,ppt,pptx,xls,xlsx,odt,odp,ods,ott,otp,ots,rtf,htm,html,txt,log<span style="color: #8c8c8c;">)</span>
    -params <span style="color: #95e454;">"&lt;key&gt;=&lt;value&gt;[&amp;&lt;key&gt;=&lt;value&gt;...]"</span> <span style="color: #8c8c8c;">(</span>values must be URL-encoded; these pass through to Solr update request<span style="color: #8c8c8c;">)</span>
    -out yes|no <span style="color: #8c8c8c;">(</span>default: no; yes outputs Solr response to console<span style="color: #8c8c8c;">)</span>
    -format solr <span style="color: #8c8c8c;">(</span>sends application/json content as Solr commands to /update instead of /update/json/docs<span style="color: #8c8c8c;">)</span>


Examples:

-*- JSON file: bin/post -c wizbang events.json
-*- XML files: bin/post -c records article*.xml
-*- CSV file: bin/post -c signals LATEST-signals.csv
-*- Directory of files: bin/post -c myfiles ~/Documents
-*- Web crawl: bin/post -c gettingstarted http://lucene.apache.org/solr -recursive <span style="color: #e5786d;">1</span> -delay <span style="color: #e5786d;">1</span>
-*- Standard input <span style="color: #8c8c8c;">(</span>stdin<span style="color: #8c8c8c;">)</span>: echo <span style="color: #95e454;">'{commit: {}}'</span> | bin/post -c my_collection -type application/json -out yes -d
-*- Data as string: bin/post -c signals -type text/csv -out yes -d $<span style="color: #95e454;">'id,value\n1,0.47'</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgc677444" class="outline-3">
<h3 id="orgc677444"><span class="section-number-3">1.6</span> Ask Question</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li>url example:
<ul class="org-ul">
<li><a href="http://localhost:8983/solr/gettingstarted/select?q=video">http://localhost:8983/solr/gettingstarted/select?q=video</a>
<ul class="org-ul">
<li>host: localhost</li>
<li>port: 8983</li>
<li>app name: solr</li>
<li>request handler: select</li>
<li>query: q</li>
</ul></li>
<li><a href="http://localhost:8983/solr/gettingstarted/select?q=video&amp;fl=id,name,price">http://localhost:8983/solr/gettingstarted/select?q=video&amp;fl=id,name,price</a>
<ul class="org-ul">
<li>fl: 返回的字段</li>
</ul></li>
<li><a href="http://localhost:8983/solr/gettingstarted/select?q=name:black">http://localhost:8983/solr/gettingstarted/select?q=name:black</a>
<ul class="org-ul">
<li>q=name:black      name值为black的文档</li>
</ul></li>
<li><a href="http://localhost:8983/solr/gettingstarted/select?q=price:%5B0%20TO%20400%5D&amp;fl=id,name,price">http://localhost:8983/solr/gettingstarted/select?q=price:[0 TO 400]&amp;fl=id,name,price</a>
<ul class="org-ul">
<li>price:[0%20TO%20400]    范围查询 链接部分需要 urlencode</li>
</ul></li>
<li><a href="http://localhost:8983/solr/gettingstarted/select?q=price:%5B0%20TO%20400%5D&amp;fl=id,name,price&amp;facet=true&amp;facet.field=cat">http://localhost:8983/solr/gettingstarted/select?q=price:[0 TO 400]&amp;fl=id,name,price&amp;facet=true&amp;facet.field=cat</a>
<ul class="org-ul">
<li>facet=true 相当于分组 (facet翻译：方面、侧面、宝石切面。意思是根据facet进行分类[分成几个侧面])</li>
<li>facet.field=cat</li>
<li>facet 的字段必须被索引</li>
<li>可以根据分组进行再次查询
<ul class="org-ul">
<li><a href="http://localhost:8983/solr/gettingstarted/select?q=price:0%20TO%20400&amp;fl=id,name,price&amp;facet=true&amp;facet.field=cat&amp;fq=cat:software">http://localhost:8983/solr/gettingstarted/select?q=price:0 TO 400&amp;fl=id,name,price&amp;facet=true&amp;facet.field=cat&amp;fq=cat:software</a></li>
</ul></li>
</ul></li>
</ul></li>
<li>documention
<ul class="org-ul">
<li><p>
responseHeader
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">responseHeader</span><span style="color: #95e454;">"</span>&gt;
&lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">status</span><span style="color: #95e454;">"</span>&gt;0&lt;/<span style="color: #cae682;">int</span>&gt;
&lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">QTime</span><span style="color: #95e454;">"</span>&gt;85&lt;/<span style="color: #cae682;">int</span>&gt;
&lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">params</span><span style="color: #95e454;">"</span>&gt;
&lt;<span style="color: #cae682;">str</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">q</span><span style="color: #95e454;">"</span>&gt;video&lt;/<span style="color: #cae682;">str</span>&gt;
&lt;/<span style="color: #cae682;">lst</span>&gt;
&lt;/<span style="color: #cae682;">lst</span>&gt;
</pre>
</div></li>
<li><p>
result 包括一个或者多个doc标签
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">result</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">response</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">numFound</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">3</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">start</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">0</span><span style="color: #95e454;">"</span>&gt;xml
&lt;<span style="color: #cae682;">doc</span>&gt;xml
&lt;<span style="color: #cae682;">str</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">id</span><span style="color: #95e454;">"</span>&gt;MA147LL/A&lt;/<span style="color: #cae682;">str</span>&gt;xml
&lt;<span style="color: #cae682;">arr</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">name</span><span style="color: #95e454;">"</span>&gt;xml
&lt;<span style="color: #cae682;">str</span>&gt;Apple 60 GB iPod with Video Playback Black&lt;/<span style="color: #cae682;">str</span>&gt;xml
&lt;/<span style="color: #cae682;">arr</span>&gt;xml
&lt;<span style="color: #cae682;">arr</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">manu</span><span style="color: #95e454;">"</span>&gt;xml
...
</pre>
</div></li>
<li><p>
facet_counts
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">facet_counts</span><span style="color: #95e454;">"</span>&gt;
  &lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">facet_queries</span><span style="color: #95e454;">"</span>/&gt;
  &lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">facet_fields</span><span style="color: #95e454;">"</span>&gt;
  &lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">cat</span><span style="color: #95e454;">"</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">electronics</span><span style="color: #95e454;">"</span>&gt;9&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">connector</span><span style="color: #95e454;">"</span>&gt;2&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">hard drive</span><span style="color: #95e454;">"</span>&gt;2&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">memory</span><span style="color: #95e454;">"</span>&gt;2&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">search</span><span style="color: #95e454;">"</span>&gt;2&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">software</span><span style="color: #95e454;">"</span>&gt;2&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">camera</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">copier</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">electronics and stuff2</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">multifunction printer</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">music</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">printer</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">scanner</span><span style="color: #95e454;">"</span>&gt;1&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">currency</span><span style="color: #95e454;">"</span>&gt;0&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">electronics and computer1</span><span style="color: #95e454;">"</span>&gt;0&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;<span style="color: #cae682;">int</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">graphics card</span><span style="color: #95e454;">"</span>&gt;0&lt;/<span style="color: #cae682;">int</span>&gt;
  &lt;/<span style="color: #cae682;">lst</span>&gt;
  &lt;/<span style="color: #cae682;">lst</span>&gt;
  &lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">facet_ranges</span><span style="color: #95e454;">"</span>/&gt;
  &lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">facet_intervals</span><span style="color: #95e454;">"</span>/&gt;
  &lt;<span style="color: #cae682;">lst</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">facet_heatmaps</span><span style="color: #95e454;">"</span>/&gt;
  &lt;/<span style="color: #cae682;">lst</span>&gt;
</pre>
</div></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9ce1fe3" class="outline-2">
<h2 id="org9ce1fe3"><span class="section-number-2">2</span> Using the Solr Administration User Interface</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-org4268316" class="outline-3">
<h3 id="org4268316"><span class="section-number-3">2.1</span> 访问</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<a href="http://hostname%3Aport/solr">http://hostname:port/solr</a>
</p>
</div>
</div>


<div id="outline-container-orgbf3fa8c" class="outline-3">
<h3 id="orgbf3fa8c"><span class="section-number-3">2.2</span> 获取帮助</h3>
<div class="outline-text-3" id="text-2-2">
<p>
底部链接
</p>
<ul class="org-ul">
<li>帮助文档</li>
<li>issue tracker</li>
<li>IRC 聊天室</li>
<li>社区论坛</li>
<li>查询语句的语法</li>
</ul>
</div>
</div>


<div id="outline-container-orgd6fde45" class="outline-3">
<h3 id="orgd6fde45"><span class="section-number-3">2.3</span> Logging</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>黄色高亮的有记录日志的能力</li>
<li>黑体字部分不受root影响</li>
</ul>
</div>
</div>


<div id="outline-container-org1190400" class="outline-3">
<h3 id="org1190400"><span class="section-number-3">2.4</span> Cloud</h3>
<div class="outline-text-3" id="text-2-4">
</div><div id="outline-container-org38ea68e" class="outline-4">
<h4 id="org38ea68e"><span class="section-number-4">2.4.1</span> Tree</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
显示zookeeper内部数据
</p>
</div>
</div>

<div id="outline-container-org40cd430" class="outline-4">
<h4 id="org40cd430"><span class="section-number-4">2.4.2</span> graph</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
显示collection的分片信息
</p>
</div>
</div>

<div id="outline-container-orge6a921f" class="outline-4">
<h4 id="orge6a921f"><span class="section-number-4">2.4.3</span> Dump</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
获取一份ZooKeeper中的solr数据快照。（帮助调试）
</p>
</div>
</div>
</div>


<div id="outline-container-orgee8416e" class="outline-3">
<h3 id="orgee8416e"><span class="section-number-3">2.5</span> Collections / Core Admin</h3>
<div class="outline-text-3" id="text-2-5">
<p>
一个实例时叫CoreAdmin 多个实例Collection
</p>
</div>
</div>


<div id="outline-container-org55becfd" class="outline-3">
<h3 id="org55becfd"><span class="section-number-3">2.6</span> Thread Dump</h3>
<div class="outline-text-3" id="text-2-6">
<p>
监视当前活动的线程，绿色对号是RUNNABLE
鼠标放到名字上会有状态显示:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">name</td>
<td class="org-left">desc</td>
</tr>

<tr>
<td class="org-left">NEW</td>
<td class="org-left">未启动</td>
</tr>

<tr>
<td class="org-left">RUNNABLE</td>
<td class="org-left">在jvm中运行</td>
</tr>

<tr>
<td class="org-left">BLOCKED</td>
<td class="org-left">阻塞</td>
</tr>

<tr>
<td class="org-left">WAITING</td>
<td class="org-left">等待</td>
</tr>

<tr>
<td class="org-left">TIMED_WAITING</td>
<td class="org-left">有时间的等待</td>
</tr>

<tr>
<td class="org-left">TERMINATED</td>
<td class="org-left">退出</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org9160ac1" class="outline-3">
<h3 id="org9160ac1"><span class="section-number-3">2.7</span> Collection-Specific Tools(只有在cloud下才能看到)</h3>
<div class="outline-text-3" id="text-2-7">
</div><div id="outline-container-orgfead205" class="outline-4">
<h4 id="orgfead205"><span class="section-number-4">2.7.1</span> Analysis</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
分析查询语句
</p>
</div>
</div>

<div id="outline-container-org3e0c3c3" class="outline-4">
<h4 id="org3e0c3c3"><span class="section-number-4">2.7.2</span> Documents</h4>
<div class="outline-text-4" id="text-2-7-2">
<p>
更新数据
</p>
</div>
</div>

<div id="outline-container-org469eff7" class="outline-4">
<h4 id="org469eff7"><span class="section-number-4">2.7.3</span> Files</h4>
<div class="outline-text-4" id="text-2-7-3">
<p>
configuration files | solrCloud展示的是ZooKeeper中的配置文件
</p>
<ol class="org-ol">
<li>solrconfig.xml
<ul class="org-ul">
<li>定义了solr如何索引内容和响应请求</li>
</ul></li>
<li>Schema 定义数据类型
<ul class="org-ul">
<li>文档字段</li>
</ul></li>
</ol>
</div>
</div>


<div id="outline-container-org53f2ca4" class="outline-4">
<h4 id="org53f2ca4"><span class="section-number-4">2.7.4</span> Stream</h4>
<div class="outline-text-4" id="text-2-7-4">
<p>
raw版本的query界面
</p>
</div>
</div>


<div id="outline-container-org41a0780" class="outline-4">
<h4 id="org41a0780"><span class="section-number-4">2.7.5</span> Schema</h4>
<div class="outline-text-4" id="text-2-7-5">
<ol class="org-ol">
<li>选择字段</li>
<li>load term info 加载根据条件取出的前N个的信息(只从Collection的一个Core取数据作为样本)</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-orgcbac142" class="outline-3">
<h3 id="orgcbac142"><span class="section-number-3">2.8</span> Core-Specific Tools</h3>
<div class="outline-text-3" id="text-2-8">
</div><div id="outline-container-org80ccad2" class="outline-4">
<h4 id="org80ccad2"><span class="section-number-4">2.8.1</span> Ping</h4>
<div class="outline-text-4" id="text-2-8-1">
<p>
查看是否能访问
</p>
<ul class="org-ul">
<li><a href="http://localhost:8983/solr/">http://localhost:8983/solr/</a>&lt;core-name&gt;/admin/ping</li>
<li><a href="http://localhost:8983/solr/gettingstarted_shard1_replica1/admin/ping?_=1481531966193&amp;ts=1481531966193&amp;wt=json">http://localhost:8983/solr/gettingstarted_shard1_replica1/admin/ping?_=1481531966193&amp;ts=1481531966193&amp;wt=json</a></li>
</ul>
</div>
</div>


<div id="outline-container-org25d100b" class="outline-4">
<h4 id="org25d100b"><span class="section-number-4">2.8.2</span> Segment</h4>
<div class="outline-text-4" id="text-2-8-2">
<p>
当前核心的片段数据
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgfcf4aa6" class="outline-2">
<h2 id="orgfcf4aa6"><span class="section-number-2">3</span> Documents, Fields, and Schema Design</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-org586601e" class="outline-3">
<h3 id="org586601e"><span class="section-number-3">3.1</span> Overview</h3>
<div class="outline-text-3" id="text-3-1">
</div><div id="outline-container-orgcfee6e1" class="outline-4">
<h4 id="orgcfee6e1"><span class="section-number-4">3.1.1</span> 原理简介</h4>
<div class="outline-text-4" id="text-3-1-1">
<ul class="org-ul">
<li>feed in (indexing or updating)</li>
<li>ask questions (query)</li>
</ul>
</div>
</div>
<div id="outline-container-org0dee4e6" class="outline-4">
<h4 id="org0dee4e6"><span class="section-number-4">3.1.2</span> Field Analysis</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
告诉solr如何处理字段，如需要忽略的字段与转换形式（a,the,an,Running=&gt;run）
</p>
</div>
</div>
<div id="outline-container-orgf792681" class="outline-4">
<h4 id="orgf792681"><span class="section-number-4">3.1.3</span> Schema File</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
告诉solr如何对输入的文档简历索引
</p>
<ul class="org-ul">
<li>默认为*managed-schema*文件</li>
<li>Cloud模式没有此文件，只能通过api或者cloud-ui看到</li>
<li>api方式修改只能修改*managed schema*指定的文件</li>
<li>solrCloud不通过api方式修改schema只能通过 upconfig 和 downconfg 让ZooKeeper管理配置文件</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orge3131c6" class="outline-3">
<h3 id="orge3131c6"><span class="section-number-3">3.2</span> Schema Detail</h3>
<div class="outline-text-3" id="text-3-2">
<p>
server/
</p>
</div>
<div id="outline-container-orgee8eb8f" class="outline-4">
<h4 id="orgee8eb8f"><span class="section-number-4">3.2.1</span> Solr Field Types</h4>
<div class="outline-text-4" id="text-3-2-1">
</div><ol class="org-ol"><li><a id="orgf719d1f"></a><span class="todo TODO">TODO</span> Field Type Definitions and Properties（完善属性定义）<br  /><div class="outline-text-5" id="text-3-2-1-1">
<ol class="org-ol">
<li>字段类型定义可以包含四种类型
<ul class="org-ul">
<li>name 必须</li>
<li>class 必须</li>
<li>如果字段类型是TextField，可以加上对field analysis</li>
<li>字段类型的属性，取决于class</li>
</ul></li>
<li>类型定义
<ul class="org-ul">
<li>放在fieldType标签中</li>
<li>可以用type标签分组</li>
</ul></li>
<li>Field Type Properties
<ul class="org-ul">
<li>&lt;fieldType name="date" class="solr.TrieDateField" sortMissingLast="true" omitNorms="true"/&gt;</li>
<li>属性被分成三种
<ol class="org-ol">
<li>针对field type的class的属性</li>
<li>常规属性
<ul class="org-ul">
<li>name</li>
<li>class</li>
<li>positionIncrementGap (对multivalue field 处理时，给两个field的词人为加上distance)</li>
<li>autoGeneratePhraseQueries</li>
<li>docValuesFormat (docValues的格式)</li>
<li>postingsFormat</li>
</ul></li>
<li>字段默认属性（替换继承的默认属性）
<ul class="org-ul">
<li>indexed (是否建立索引)</li>
<li>stored (是否存储内容)</li>
<li>docValues ( 可以提升如排序,分面,高亮的性能)</li>
<li>sortMissingFirst/sortMissingLast</li>
<li>multiValued (多值)</li>
</ul></li>
</ol></li>
</ul></li>
<li>例子:</li>
</ol>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">fieldType</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">ancestor_path</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">class</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">solr.TextField</span><span style="color: #95e454;">"</span>&gt;
  &lt;<span style="color: #cae682;">analyzer</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">index</span><span style="color: #95e454;">"</span>&gt;
    &lt;<span style="color: #cae682;">tokenizer</span> <span style="color: #cae682;">class</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">solr.KeywordTokenizerFactory</span><span style="color: #95e454;">"</span>/&gt;
  &lt;/<span style="color: #cae682;">analyzer</span>&gt;
  &lt;<span style="color: #cae682;">analyzer</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">query</span><span style="color: #95e454;">"</span>&gt;
    &lt;<span style="color: #cae682;">tokenizer</span> <span style="color: #cae682;">class</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">solr.PathHierarchyTokenizerFactory</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">delimiter</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">/</span><span style="color: #95e454;">"</span>/&gt;
  &lt;/<span style="color: #cae682;">analyzer</span>&gt;
&lt;/<span style="color: #cae682;">fieldType</span>&gt;
</pre>
</div>
</div></li>

<li><a id="org8a92e94"></a><span class="todo TODO">TODO</span> Field Types Included with Solr<br  /></li>
<li><a id="org8629135"></a><span class="todo TODO">TODO</span> Working with Currencies and Exchange Rates<br  /></li>
<li><a id="org3d11f86"></a><span class="todo TODO">TODO</span> Working with Dates<br  /></li>
<li><a id="org08522ca"></a><span class="todo TODO">TODO</span> Working with Enum Fields<br  /></li>
<li><a id="orgbb83b54"></a><span class="todo TODO">TODO</span> Working with External Files and Processes<br  /></li></ol>
</div>


<div id="outline-container-orga550b71" class="outline-4">
<h4 id="orga550b71"><span class="section-number-4">3.2.2</span> Defining Fields</h4>
<div class="outline-text-4" id="text-3-2-2">
</div><ol class="org-ol"><li><a id="orgb73b732"></a>example<br  /><div class="outline-text-5" id="text-3-2-2-1">
<ul class="org-ul">
<li>&lt;field name="price" type="float" default="0.0" indexed="true" stored="true"/&gt;</li>
</ul>
</div></li>

<li><a id="org955cce4"></a>Field Properties<br  /><div class="outline-text-5" id="text-3-2-2-2">
<ul class="org-ul">
<li>name (must)</li>
<li>type (must)</li>
<li>default (optional)</li>
</ul>
</div></li>

<li><a id="orge4a16cc"></a><span class="todo TODO">TODO</span> Optional Field Type Override Properties<br  /><div class="outline-text-5" id="text-3-2-2-3">
<p>
会覆盖掉 fieldType 属性的属性
</p>
</div></li></ol>
</div>


<div id="outline-container-orga30e545" class="outline-4">
<h4 id="orga30e545"><span class="section-number-4">3.2.3</span> Copying Fields</h4>
<div class="outline-text-4" id="text-3-2-3">
<ul class="org-ul">
<li>为一个数据应用多种不同的字段类型</li>
<li>需要搜索多个字段, 可以通过*copyField*组成一个字段，然后配置成默认搜索此字段。</li>
<li>使用*copyField*会造成索引数据的增长</li>
<li>source和dest开头或者结尾可以有*表示匹配所有(表示通配符)</li>
</ul>
</div>
<ol class="org-ol"><li><a id="org192e032"></a>主要字段<br  /><div class="outline-text-5" id="text-3-2-3-1">
<ul class="org-ul">
<li>source 被复制的字段名称</li>
<li>dest 复制到的名称</li>
<li>maxChars 限制从source最多复制的字符 (想要控制index大小时有用)</li>
</ul>
</div></li>

<li><a id="org1161efb"></a>example<br  /><div class="outline-text-5" id="text-3-2-3-2">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">copyField</span> <span style="color: #cae682;">source</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">cat</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">dest</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">text</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">maxChars</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">30000</span><span style="color: #95e454;">"</span> /&gt;
&lt;<span style="color: #cae682;">copyField</span> <span style="color: #cae682;">source</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">*_t</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">dest</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">text</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">maxChars</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">25000</span><span style="color: #95e454;">"</span> /&gt;
</pre>
</div>
<p>
如果text中有数据，那么cat中的内容将会添加到text中。
</p>

<p>
如果dest的source是多个值组成的，或者dest有多个source需要把dest字段设置成multivalued="true"
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">schema</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">eshequn.post.db_post.0</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">version</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">1.1</span><span style="color: #95e454;">"</span> <span style="color: #e5786d;">xmlns</span>:<span style="color: #cae682;">xi</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">http://www.w3.org/2001/XInclude</span><span style="color: #95e454;">"</span>&gt;  
  &lt;<span style="color: #cae682;">fields</span>&gt;  
    &lt;<span style="color: #cae682;">field</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">title</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">text</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">indexed</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">true</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">stored</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">false</span><span style="color: #95e454;">"</span> /&gt;  
    &lt;<span style="color: #cae682;">field</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">content</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">text</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">indexed</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">true</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">stored</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">false</span><span style="color: #95e454;">"</span> /&gt;  
    &lt;<span style="color: #cae682;">field</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">tc</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">text</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">indexed</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">true</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">stored</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">false</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">multiValued</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">true</span><span style="color: #95e454;">"</span>/&gt;  
  &lt;/<span style="color: #cae682;">fields</span>&gt;  
  &lt;<span style="color: #cae682;">copyField</span> <span style="color: #cae682;">source</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">title</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">dest</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">tc</span><span style="color: #95e454;">"</span> /&gt;  
  &lt;<span style="color: #cae682;">copyField</span> <span style="color: #cae682;">source</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">content</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">dest</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">tc</span><span style="color: #95e454;">"</span> /&gt;  
&lt;
/schema&gt;
</pre>
</div>
</div></li></ol>
</div>


<div id="outline-container-org0d242ee" class="outline-4">
<h4 id="org0d242ee"><span class="section-number-4">3.2.4</span> Dynamic Fields</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
顾名思义，动态字段。
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">dynamicField</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">*_i</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">int</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">indexed</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">true</span><span style="color: #95e454;">"</span> <span style="color: #cae682;">stored</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">true</span><span style="color: #95e454;">"</span>/&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-orga7964a7" class="outline-4">
<h4 id="orga7964a7"><span class="section-number-4">3.2.5</span> Other Elements</h4>
<div class="outline-text-4" id="text-3-2-5">
</div><ol class="org-ol"><li><a id="org88e89c6"></a>Unique Key<br  /><div class="outline-text-5" id="text-3-2-5-1">
<p>
指定文档的唯一标志(更新文档的时候有用)
</p>
</div></li>
<li><a id="org8524867"></a>Default Search Field &amp; Query Operator<br  /><div class="outline-text-5" id="text-3-2-5-2">
<ul class="org-ul">
<li>&lt;defaultSearchField/&gt; 已经被df参数取代</li>
<li>&lt;solrQueryParserdefaultOperator="OR"/&gt; 被q.op取代</li>
</ul>
</div></li>
<li><a id="org2970bac"></a>Similarity<br  /><div class="outline-text-5" id="text-3-2-5-3">
<p>
用来在搜索时获取文档的相关度(score)。自定义评分器。
</p>
<ul class="org-ul">
<li>每个文档只能有一个全局的Similarity</li>
<li>默认行为BM25SimilarityFactory</li>
<li>通过&lt;similarity/&gt; 标签可以覆盖默认行为</li>
<li>可以通过两种形式实现</li>
<li><img src="http://static.oschina.net/uploads/space/2012/0327/191046_bwnq_100580.png" alt="191046_bwnq_100580.png" /></li>
</ul>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #cae682;">similarity</span> <span style="color: #cae682;">class</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">solr.BM25SimilarityFactory</span><span style="color: #95e454;">"</span>/&gt;
&lt;<span style="color: #cae682;">similarity</span> <span style="color: #cae682;">class</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">solr.DFRSimilarityFactory</span><span style="color: #95e454;">"</span>&gt;
    &lt;<span style="color: #cae682;">str</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">basicModel</span><span style="color: #95e454;">"</span>&gt;P&lt;/<span style="color: #cae682;">str</span>&gt;
    &lt;<span style="color: #cae682;">str</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">afterEffect</span><span style="color: #95e454;">"</span>&gt;L&lt;/<span style="color: #cae682;">str</span>&gt;
    &lt;<span style="color: #cae682;">str</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">normalization</span><span style="color: #95e454;">"</span>&gt;H2&lt;/<span style="color: #cae682;">str</span>&gt;
    &lt;<span style="color: #cae682;">float</span> <span style="color: #cae682;">name</span>=<span style="color: #95e454;">"</span><span style="color: #95e454;">c</span><span style="color: #95e454;">"</span>&gt;7&lt;/<span style="color: #cae682;">float</span>&gt;
&lt;/<span style="color: #cae682;">similarity</span>&gt;
</pre>
</div>
</div></li></ol>
</div>


<div id="outline-container-orgecc5c20" class="outline-4">
<h4 id="orgecc5c20"><span class="section-number-4">3.2.6</span> Schema API</h4>
<div class="outline-text-4" id="text-3-2-6">
<p>
提供一种通过http请求来读取和修改schema的方式
</p>
<ul class="org-ul">
<li>schema修改之后只会改变后来的文档索引形式，不会改变之前的索引文档。所以必须重新索引所有的文档</li>
<li>output format： json | xml</li>
<li><a href="http://">http://</a>&lt;host&gt;:&lt;port&gt;/solr/&lt;collection_name&gt;/schema/</li>
</ul>
</div>
<ol class="org-ol"><li><a id="orgc045bf6"></a>API Entry Points<br  /><div class="outline-text-5" id="text-3-2-6-1">
<ul class="org-ul">
<li>/schema: retrieve the schema, or modify the schema to add, remove, or replace fields, dynamic fields, copy fields, or field types</li>
<li>/schema/fields: retrieve information about all defined fields or a specific named field</li>
<li>/schema/dynamicfields: retrieve information about all dynamic field rules or a specific named dynamic rule</li>
<li>/schema/fieldtypes: retrieve information about all field types or a specific field type</li>
<li>/schema/copyfields: retrieve information about copy fields</li>
<li>/schema/name: retrieve the schema name</li>
<li>/schema/version: retrieve the schema version</li>
<li>/schema/uniquekey: retrieve the defined uniqueKey</li>
<li>/schema/similarity: retrieve the global similarity definition</li>
<li>/schema/solrqueryparser/defaultoperator: retrieve the default operator</li>
</ul>
</div></li>

<li><a id="orgae66600"></a>Modify the Schema<br  /><div class="outline-text-5" id="text-3-2-6-2">
<div class="org-src-container">
<pre class="src src-curl">    "add-field":{ "name":"sell-by", "type":"tdate", "stored":true } 
}' http://localhost:8983/solr/gettingstarted/schema
</pre>
</div>
</div>

<ol class="org-ol"><li><a id="org87cffeb"></a>Schema Changes among Replicas<br  /><div class="outline-text-6" id="text-3-2-6-2-1">
<p>
在一个复制集上做的更改会改到其他的复制集上面
</p>
</div></li></ol></li>

<li><a id="orgd512f1a"></a>Retrieve Schema Information<br  /><div class="outline-text-5" id="text-3-2-6-3">
<pre class="example">
curl http://localhost:8983/solr/gettingstarted/schema?wt=json
curl http://localhost:8983/solr/gettingstarted/schema?wt=xml
curl http://localhost:8983/solr/gettingstarted/schema?wt=schema.xml
curl http://localhost:8983/solr/gettingstarted/schema/fields?wt=json[fl=string,string
&amp;includeDynamic=bool&amp;showDefaults=bool]
</pre>
</div></li></ol>
</div>


<div id="outline-container-orgf04c763" class="outline-4">
<h4 id="orgf04c763"><span class="section-number-4">3.2.7</span> Putting the Pieces Together</h4>
<div class="outline-text-4" id="text-3-2-7">
</div><ol class="org-ol"><li><a id="org5bc3279"></a>Choosing Appropriate Numeric Types<br  /><div class="outline-text-5" id="text-3-2-7-1">
<ol class="org-ol">
<li>一般情况下 使用
<ul class="org-ul">
<li>TrieIntField</li>
<li>TrieLongField</li>
<li>TrieFloatField</li>
<li>TrieDoubleFiel</li>
<li>precisionStep="0"</li>
</ul></li>
<li>数字经常被指定范围
<ul class="org-ul">
<li>precisionStep="8"</li>
</ul></li>
</ol>
</div></li>


<li><a id="org3057b97"></a>Working With Text<br  /><div class="outline-text-5" id="text-3-2-7-2">
<ol class="org-ol">
<li>通过使用一个txt field将所有字段汇总成一个搜索(用到了copyField)</li>
<li>通过copyField将一个字段作为不同的用处</li>
</ol>
</div></li>


<li><a id="org8c85f39"></a>DocValues<br  /><div class="outline-text-5" id="text-3-2-7-3">
<ul class="org-ul">
<li>传统的index是一种倒排索引<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> 并且是term-to-document的list,对于使用term来搜索时，这种方式很快</li>
<li>但是若是使用facet、sort、hightlight这些特性，就会很慢</li>
<li>docvalues 是一种 面向列 的字段索引方式，并且使用了document-to-value的list</li>
<li>indexed 和 docValues 只能指定一个为true</li>
<li>只能开启以下几个类型的docValues
<ol class="org-ol">
<li>StrField</li>
<li>UUIDField</li>
<li>Trie* numeric fields</li>
<li>date</li>
<li>EnumField</li>
</ol></li>
</ul>
</div></li>

<li><a id="org47e48f9"></a><span class="todo TODO">TODO</span> Using DocValues<br  /></li>

<li><a id="org47a5e24"></a><span class="todo TODO">TODO</span> Schemaless Mode<br  /><div class="outline-text-5" id="text-3-2-7-5">
</div></li></ol>
</div>
</div>
</div>
<div id="outline-container-orgdb08e04" class="outline-2">
<h2 id="orgdb08e04"><span class="section-number-2">4</span> <span class="todo TODO">TODO</span> Using Analyzers, Tokenizers, and Filters</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-org42f93b0" class="outline-3">
<h3 id="org42f93b0"><span class="section-number-3">4.1</span> </h3>
</div>
</div>
<div id="outline-container-org4c0f96a" class="outline-2">
<h2 id="org4c0f96a"><span class="section-number-2">5</span> Indexing and Basic Data Operations</h2>
<div class="outline-text-2" id="text-5">
<p>
三种常用的方式可以向solr index中填充数据
</p>
<ul class="org-ul">
<li>Solr Cell</li>
<li>xml file</li>
<li>Solr's Java Client API</li>
</ul>
<p>
填入的数据总是要包含多个字段，每个字段都有一个name和一个content
实验文件夹：example/exampledocs/
</p>
</div>

<div id="outline-container-org7274738" class="outline-3">
<h3 id="org7274738"><span class="section-number-3">5.1</span> Post Tool</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-org50b7a0e" class="outline-4">
<h4 id="org50b7a0e"><span class="section-number-4">5.1.1</span> bin/post</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-sh">bin/post -c gettingstarted example/films/films.json
bin/post -h
bin/post -c gettingstarted *.xml
bin/post -c gettingstarted -p <span style="color: #e5786d;">8984</span> *.xml
bin/post -c gettingstarted -d <span style="color: #95e454;">'&lt;delete&gt;&lt;id&gt;42&lt;/id&gt;&lt;/delete&gt;'</span>
bin/post -c gettingstarted *.csv
bin/post -c gettingstarted -params <span style="color: #95e454;">"separator=%09"</span> -type text/csv data.csv
bin/post -c gettingstarted *.json
bin/post -c gettingstarted a.pdf

bin/post -p port -host host -c collection_name json_file.json
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#33258;&#21160;&#26816;&#27979;&#25991;&#20214;&#22841;&#20013;&#30340;&#25991;&#26723;&#31867;&#22411;&#65292;&#36882;&#24402;&#30340;&#36827;&#34892;&#32034;&#24341;&#25968;&#25454;</span>
bin/post -c gettingstarted afolder/
bin/post -c gettingstarted -filetypes ppt,html afolder/
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#32034;&#24341;&#19968;&#20010;&#24102;&#26377;&#23494;&#30721;&#30340;pdf &#23494;&#30721;&#20026;SolrRocks</span>
bin/post -u solr:SolrRocks -c gettingstarted a.pdf
</pre>
</div>
</div>
</div>


<div id="outline-container-org30d39e9" class="outline-4">
<h4 id="org30d39e9"><span class="section-number-4">5.1.2</span> SimplePostTool</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
java -jar example/exampledocs/post.jar -h
</p>
</div>
</div>
</div>


<div id="outline-container-orgb2806b7" class="outline-3">
<h3 id="orgb2806b7"><span class="section-number-3">5.2</span> Uploading Data with Index Handlers</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-sh">curl -X POST -H <span style="color: #95e454;">'Content-Type: application/json'</span> <span style="color: #95e454;">'http://localhost:8983/solr/my_collection/update'</span> --data-binary <span style="color: #95e454;">' [ { "id": "1", "title": "Doc 1" }, { "id": "2", "title": "Doc 2" } ]'</span>
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#25351;&#23450;&#25991;&#20214;</span>
curl <span style="color: #95e454;">'http://localhost:8983/solr/techproducts/update?commit=true'</span> --data-binary @example/exampledocs/books.json -H <span style="color: #95e454;">'Content-type:application/json'</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org92dbbe2" class="outline-3">
<h3 id="org92dbbe2"><span class="section-number-3">5.3</span> <span class="todo TODO">TODO</span> Uploading Data with Solr Cell using Apache Tika</h3>
<div class="outline-text-3" id="text-5-3">
<p>
导入多种不同的数据格式时有用，如二进制文件、word文档、pdf文档等。
</p>
</div>
</div>
</div>

<div id="outline-container-org88e9a32" class="outline-2">
<h2 id="org88e9a32"><span class="section-number-2">6</span> Search</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-org43d93f8" class="outline-3">
<h3 id="org43d93f8"><span class="section-number-3">6.1</span> Overview</h3>
<div class="outline-text-3" id="text-6-1">
</div><div id="outline-container-org2c99950" class="outline-4">
<h4 id="org2c99950"><span class="section-number-4">6.1.1</span> 输入查询语句</h4>
</div>
<div id="outline-container-org1ad3370" class="outline-4">
<h4 id="org1ad3370"><span class="section-number-4">6.1.2</span> 查询语句被 <b>request handler</b> 处理 (此插件定义了solr处理请求的逻辑)</h4>
</div>
<div id="outline-container-org45a630e" class="outline-4">
<h4 id="org45a630e"><span class="section-number-4">6.1.3</span> 调用 <b>query parser</b> (解析器解释查询的条件和参数)</h4>
<div class="outline-text-4" id="text-6-1-3">
<ol class="org-ol">
<li>解析器的种类
<ol class="org-ol">
<li>Standard Query Parser (清晰)</li>
<li>DisMax (很少报错)</li>
<li>eDisMax (扩展版的DisMax，完全支持 lucene 查询语法)</li>
</ol></li>
<li>common query parameters  (支持全部的解析器)</li>
<li>解析器输入种类
<ol class="org-ol">
<li>查询语句</li>
<li>对查询语句的微调参数</li>
<li>对查询结果展示的控制</li>
</ol></li>
</ol>
</div>
</div>
<div id="outline-container-org333702d" class="outline-4">
<h4 id="org333702d"><span class="section-number-4">6.1.4</span> *filter query*(fq) (filter query 会开辟一块单独的缓存，这种策略对性能提升很大)</h4>
<div class="outline-text-4" id="text-6-1-4">
<ol class="org-ol">
<li>Filter queries 只查询索引中存在的数据</li>
</ol>
</div>
</div>
<div id="outline-container-org5be3da3" class="outline-4">
<h4 id="org5be3da3"><span class="section-number-4">6.1.5</span> 指定特定的条件高亮</h4>
</div>
<div id="outline-container-orgdb58c1d" class="outline-4">
<h4 id="orgdb58c1d"><span class="section-number-4">6.1.6</span> 返回结果可以有一个小片段，像是谷歌的搜索</h4>
</div>
<div id="outline-container-org15ebb5f" class="outline-4">
<h4 id="org15ebb5f"><span class="section-number-4">6.1.7</span> 对结果分组</h4>
<div class="outline-text-4" id="text-6-1-7">
<ol class="org-ol">
<li>faceting
<ol class="org-ol">
<li>facet 分组字段（对结果进行分组）</li>
<li>facet count 分组得到的结果的数量</li>
<li>constraints 分组得到的结果的值</li>
<li>breadcrumb 面包屑（已经应用的facet）</li>
<li>list 结果详情</li>
</ol></li>
<li>clustering</li>
</ol>
</div>
</div>
<div id="outline-container-org9b49b59" class="outline-4">
<h4 id="org9b49b59"><span class="section-number-4">6.1.8</span> MoreLikeThis</h4>
</div>
<div id="outline-container-org835c411" class="outline-4">
<h4 id="org835c411"><span class="section-number-4">6.1.9</span> response writer (返回结果的形式)</h4>
<div class="outline-text-4" id="text-6-1-9">
<ol class="org-ol">
<li>XML Response Writer</li>
<li>JSON Response Writer</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-org661dd3d" class="outline-3">
<h3 id="org661dd3d"><span class="section-number-3">6.2</span> 通用查询语句</h3>
<div class="outline-text-3" id="text-6-2">
</div><div id="outline-container-org18b6ec7" class="outline-4">
<h4 id="org18b6ec7"><span class="section-number-4">6.2.1</span> defType:</h4>
<div class="outline-text-4" id="text-6-2-1">
<ol class="org-ol">
<li>选择查询解析器</li>
<li>dismax/lucene</li>
<li>defType=dismax</li>
</ol>
</div>
</div>

<div id="outline-container-org4950cbf" class="outline-4">
<h4 id="org4950cbf"><span class="section-number-4">6.2.2</span> sort:</h4>
<div class="outline-text-4" id="text-6-2-2">
<ol class="org-ol">
<li>对返回结果排序，asc|desc</li>
<li>可以对数字和字母排序</li>
<li>排序规则
<ol class="org-ol">
<li>根据文档相关程度排序</li>
<li>或者是根据字段的值排序，这个字段的值要么被索引要么使用了*DocValues*</li>
</ol></li>
<li>单独字段排序：&lt;field_name&gt;+(asc|desc)</li>
<li>多字段排序：sort=&lt;field name&gt;+&lt;direction&gt;,&lt;field name&gt;+&lt;direction&gt;],&#x2026;</li>
</ol>
</div>
</div>

<div id="outline-container-org436cf56" class="outline-4">
<h4 id="org436cf56"><span class="section-number-4">6.2.3</span> start:</h4>
<div class="outline-text-4" id="text-6-2-3">
<ul class="org-ul">
<li>初始位置</li>
</ul>
</div>
</div>

<div id="outline-container-org5edd57c" class="outline-4">
<h4 id="org5edd57c"><span class="section-number-4">6.2.4</span> rows:</h4>
<div class="outline-text-4" id="text-6-2-4">
<ul class="org-ul">
<li>相当于mysql中的limit</li>
</ul>
</div>
</div>

<div id="outline-container-orgdbfec52" class="outline-4">
<h4 id="orgdbfec52"><span class="section-number-4">6.2.5</span> fq:</h4>
<div class="outline-text-4" id="text-6-2-5">
<ol class="org-ol">
<li>对结果过滤的条件</li>
<li>对将要返回的文档过滤（不会影响score【猜测是相关度】）</li>
<li>对复杂的query进行加速，因为会对fq进行的查询独立进行缓存</li>
<li>fq参数可以出现多次
<ol class="org-ol">
<li>`fq=popularity:[10 TO *]&amp;fq=section:0` （当条件经常单独出现时）</li>
<li>`fq=+popularity:[10 TO *] +section:0` (当条件经常单独出现时)</li>
</ol></li>
<li>url-encoding 参考地址 ：  <a href="http://meyerweb.com/eric/tools/dencoder/">http://meyerweb.com/eric/tools/dencoder/</a></li>
</ol>
</div>
</div>

<div id="outline-container-org5dcae54" class="outline-4">
<h4 id="org5dcae54"><span class="section-number-4">6.2.6</span> fl:</h4>
<div class="outline-text-4" id="text-6-2-6">
<ol class="org-ol">
<li>设定返回结果的字段,用逗号或者空格分开</li>
<li>stored="true" or docValues="true" or useDocValuesAsStored="true"(在docvalues模式开启时是默认的)</li>
<li>字段可以是个函数 如：fl=id,title,product(price,popularity)</li>
<li>别名：fl=id,sales_price:price,secret_sauce:prod(price,popularity),why_score:[explain style=nl]</li>
</ol>
</div>
</div>

<div id="outline-container-org81867fe" class="outline-4">
<h4 id="org81867fe"><span class="section-number-4">6.2.7</span> debug:</h4>
<div class="outline-text-4" id="text-6-2-7">
<ol class="org-ol">
<li>返回额外的调试信息。</li>
<li>debug=timing只返回时间信息.</li>
<li>debug=results返回对返回结果的每个文档的解释。</li>
<li>debug=all(true)将返回所有的调试信息。debugQuery=true</li>
</ol>
</div>
</div>

<div id="outline-container-orgcec2543" class="outline-4">
<h4 id="orgcec2543"><span class="section-number-4">6.2.8</span> explainOther:</h4>
<div class="outline-text-4" id="text-6-2-8">
<ul class="org-ul">
<li>q=supervillians&amp;debugQuery=on&amp;explainOther=id\:juggernaut</li>
<li>返回调试信息</li>
<li>必须加上debugQuery=on否则不返回debug字段</li>
</ul>
</div>
</div>

<div id="outline-container-orgb3657d2" class="outline-4">
<h4 id="orgb3657d2"><span class="section-number-4">6.2.9</span> timeAllowed：</h4>
<div class="outline-text-4" id="text-6-2-9">
<ul class="org-ul">
<li>超过此时间之后，只会返回一部分数据</li>
</ul>
</div>
</div>

<div id="outline-container-orgc0af135" class="outline-4">
<h4 id="orgc0af135"><span class="section-number-4">6.2.10</span> omitHeader:</h4>
<div class="outline-text-4" id="text-6-2-10">
<ul class="org-ul">
<li>不返回头部信息</li>
</ul>
</div>
</div>

<div id="outline-container-orgca7c8ca" class="outline-4">
<h4 id="orgca7c8ca"><span class="section-number-4">6.2.11</span> wt:</h4>
<div class="outline-text-4" id="text-6-2-11">
<ul class="org-ul">
<li>返回结果的格式</li>
</ul>
</div>
</div>

<div id="outline-container-org0a413a3" class="outline-4">
<h4 id="org0a413a3"><span class="section-number-4">6.2.12</span> cache=false:</h4>
<div class="outline-text-4" id="text-6-2-12">
<ul class="org-ul">
<li>停止缓存所有的查询和过滤条件的结果</li>
</ul>
</div>
</div>

<div id="outline-container-org86a050d" class="outline-4">
<h4 id="org86a050d"><span class="section-number-4">6.2.13</span> logParamsList(version &gt;= 4.7):</h4>
<div class="outline-text-4" id="text-6-2-13">
<ul class="org-ul">
<li>默认会记录所有的字段，logParamsList=param1,param2逗号分割的参数</li>
</ul>
</div>
</div>

<div id="outline-container-org8e275c5" class="outline-4">
<h4 id="org8e275c5"><span class="section-number-4">6.2.14</span> echoParams:</h4>
<div class="outline-text-4" id="text-6-2-14">
<p>
在response header 中的 params 字段中显示所用到的查询字段
</p>
<ol class="org-ol">
<li>explicit(默认)</li>
<li>all</li>
<li>none</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-orge30e834" class="outline-3">
<h3 id="orge30e834"><span class="section-number-3">6.3</span> The Standard Query Parser (lucene parser)</h3>
<div class="outline-text-3" id="text-6-3">
<p>
优点：直观，缺点：不能有语法错误
</p>
</div>
<div id="outline-container-orga163d40" class="outline-4">
<h4 id="orga163d40"><span class="section-number-4">6.3.1</span> q</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
查询语句，强制性
</p>
<pre class="example">
http://localhost:8983/solr/techproducts/select?q=id:SP2514N
q=*:* 查询全部,特殊情况
</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">?</td>
<td class="org-left">匹配单个字符</td>
</tr>

<tr>
<td class="org-left">*</td>
<td class="org-left">匹配多个字符</td>
</tr>

<tr>
<td class="org-left">~</td>
<td class="org-left">模糊搜索 roam~ 将会匹配foam，foams等</td>
</tr>

<tr>
<td class="org-left">~1</td>
<td class="org-left">模糊搜索 roam~ 将会匹配foam，不会匹配foams，因为foams改动了两个字</td>
</tr>

<tr>
<td class="org-left">"jakarta apache"~10</td>
<td class="org-left">两个词之间改动10个位置可以匹配到</td>
</tr>

<tr>
<td class="org-left">mod_date:[20020101 TO 20030101]</td>
<td class="org-left">范围查询</td>
</tr>

<tr>
<td class="org-left">title:{Aida TO Smith}</td>
<td class="org-left">大括号表示不包含上下边界</td>
</tr>

<tr>
<td class="org-left">jakarta^4 apache</td>
<td class="org-left">boost factor 可以通过改变这个值改变查询时的相关度,可以小于1</td>
</tr>

<tr>
<td class="org-left">(description:blue OR color:blue)^=1.0 text:shoes</td>
<td class="org-left">将匹配括号中的语句的文档相关度设置成1</td>
</tr>

<tr>
<td class="org-left">title:"The Right Way" AND text:go</td>
<td class="org-left">指定字段查询</td>
</tr>

<tr>
<td class="org-left">title:"Do it right" AND go</td>
<td class="org-left">第二个字段直接查询默认搜索字段</td>
</tr>

<tr>
<td class="org-left">(AND/&amp;&amp;),(OR/ll),(+),(-),(NOT !)</td>
<td class="org-left">操作符</td>
</tr>

<tr>
<td class="org-left">+ - &amp;&amp; ll ! ( ) { } [ ] ^ " ~ * ? : /</td>
<td class="org-left">需要转义的字符</td>
</tr>

<tr>
<td class="org-left">(jakarta OR apache) AND website</td>
<td class="org-left">表达式 website存在并且有jakarta或者apache</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgaa5a506" class="outline-4">
<h4 id="orgaa5a506"><span class="section-number-4">6.3.2</span> q.op</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
指定查询语句默认是用*AND*还是*OR*
</p>
</div>
</div>


<div id="outline-container-org594fca4" class="outline-4">
<h4 id="org594fca4"><span class="section-number-4">6.3.3</span> df</h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
指定默认搜索的字段
</p>
</div>
</div>
</div>


<div id="outline-container-orge9a31ae" class="outline-3">
<h3 id="orge9a31ae"><span class="section-number-3">6.4</span> <span class="todo TODO">TODO</span> The DisMax Query Parser</h3>
<div class="outline-text-3" id="text-6-4">
</div><div id="outline-container-org8f5f848" class="outline-4">
<h4 id="org8f5f848"><span class="section-number-4">6.4.1</span> Parameters</h4>
</div>
</div>


<div id="outline-container-org09fb0f3" class="outline-3">
<h3 id="org09fb0f3"><span class="section-number-3">6.5</span> Faceting</h3>
<div class="outline-text-3" id="text-6-5">
<p>
对结果进行分类(分组),很方便查询每个条件有多少文档。
必要条件：facet的字段必须被索引indexed=true
</p>
</div>
<div id="outline-container-orga0cab40" class="outline-4">
<h4 id="orga0cab40"><span class="section-number-4">6.5.1</span> General Parameters</h4>
<div class="outline-text-4" id="text-6-5-1">
<ol class="org-ol">
<li>facet=true(on) ,  默认为假
<ol class="org-ol">
<li>不会改变结果字段，只会添加一个 facet_counts 字段</li>
</ol></li>
<li>facet.query 指定计算count的表达式
facet.query={!myfunc}name~fred</li>
</ol>
</div>
</div>

<div id="outline-container-org2f02342" class="outline-4">
<h4 id="org2f02342"><span class="section-number-4">6.5.2</span> Field-Value Faceting Parameters</h4>
<div class="outline-text-4" id="text-6-5-2">
<ol class="org-ol">
<li>facet.field  
分组的字段</li>
<li>facet.prefix 
限制facet.field 的前缀，不同则不分类</li>
<li>facet.limit  
facet_counts 字段返回条数, 默认100</li>
<li>facet.sort
<ul class="org-ul">
<li>count 根据数量排序</li>
<li>index (default)</li>
</ul></li>
<li>facet.offset 
开始条数,偏移量,它与facet.limit配合使用可以达到分页的效果</li>
<li>facet.mincount 
facet_counts 字段中最小的数量，低于此值不显示</li>
<li>facet.missing 
是否返回没有值的field</li>
<li>facet.method 
取值为enum或fc,默认为fc, fc表示Field Cache
<ul class="org-ul">
<li>enum 适用于值较少的</li>
</ul></li>
</ol>
</div>
</div>


<div id="outline-container-orga3c36c5" class="outline-4">
<h4 id="orga3c36c5"><span class="section-number-4">6.5.3</span> facet.pivot</h4>
<div class="outline-text-4" id="text-6-5-3">
<p>
不会翻译， 作用比较像是 mysql 中将两个字段进行分组,然后rollup,获得一个统计数据
返回字段 facet_count.facet_pivot
</p>
<ul class="org-ul">
<li><a href="http://localhost:8983/solr/techproducts/select?q=*:*&amp;facet.pivot=cat,popularity,inStock&amp;facet.pivot=popularity,cat&amp;facet=true&amp;facet.field=cat&amp;facet.limit=5&amp;rows=0&amp;wt=json&amp;indent=true&amp;facet.pivot.mincount=2">http://localhost:8983/solr/techproducts/select?q=*:*&amp;facet.pivot=cat,popularity,inStock&amp;facet.pivot=popularity,cat&amp;facet=true&amp;facet.field=cat&amp;facet.limit=5&amp;rows=0&amp;wt=json&amp;indent=true&amp;facet.pivot.mincount=2</a></li>
</ul>
</div>
</div>
</div>



<div id="outline-container-org5cf2d00" class="outline-3">
<h3 id="org5cf2d00"><span class="section-number-3">6.6</span> Highlighter</h3>
<div class="outline-text-3" id="text-6-6">
</div><div id="outline-container-org922ac84" class="outline-4">
<h4 id="org922ac84"><span class="section-number-4">6.6.1</span> Standard Highlighter</h4>
</div>
</div>
</div>

<div id="outline-container-orgc96926b" class="outline-2">
<h2 id="orgc96926b"><span class="section-number-2">7</span> solrCloud</h2>
<div class="outline-text-2" id="text-7">
<p>
server/solr
</p>
</div>
<div id="outline-container-org1ed3883" class="outline-3">
<h3 id="org1ed3883"><span class="section-number-3">7.1</span> features</h3>
<div class="outline-text-3" id="text-7-1">
<ol class="org-ol">
<li>集中式配置管理</li>
<li>自动化负载均衡和故障切换</li>
<li>ZooKeeper 整合</li>
</ol>
</div>
</div>


<div id="outline-container-org101c5f9" class="outline-3">
<h3 id="org101c5f9"><span class="section-number-3">7.2</span> 相关概念</h3>
<div class="outline-text-3" id="text-7-2">
</div><div id="outline-container-orgb2f4d7b" class="outline-4">
<h4 id="orgb2f4d7b"><span class="section-number-4">7.2.1</span> Node</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
solr实例
</p>
</div>
</div>
<div id="outline-container-orgc324123" class="outline-4">
<h4 id="orgc324123"><span class="section-number-4">7.2.2</span> Cluster</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
可以包含多个Collection，由一个或者多个node组成
</p>
</div>
</div>
<div id="outline-container-orgc11ed11" class="outline-4">
<h4 id="orgc11ed11"><span class="section-number-4">7.2.3</span> Collection</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
在SolrCloud集群中逻辑意义上的完整的索引, 可以分到多个Shards上
</p>
</div>
</div>
<div id="outline-container-org594bb1a" class="outline-4">
<h4 id="org594bb1a"><span class="section-number-4">7.2.4</span> Config Set</h4>
<div class="outline-text-4" id="text-7-2-4">
<p>
Solr Core提供服务必须的一组配置文件
</p>
</div>
</div>
<div id="outline-container-orgfb7c6e0" class="outline-4">
<h4 id="orgfb7c6e0"><span class="section-number-4">7.2.5</span> Leader</h4>
<div class="outline-text-4" id="text-7-2-5">
<p>
赢得选举的Shard replicas
</p>
</div>
</div>
<div id="outline-container-org60dc663" class="outline-4">
<h4 id="org60dc663"><span class="section-number-4">7.2.6</span> Replica</h4>
<div class="outline-text-4" id="text-7-2-6">
<p>
Shard的一个拷贝
</p>
</div>
</div>
<div id="outline-container-org50d0361" class="outline-4">
<h4 id="org50d0361"><span class="section-number-4">7.2.7</span> Shard</h4>
<div class="outline-text-4" id="text-7-2-7">
<p>
Collection的逻辑分片。一个shard上面一个leader replica
</p>
</div>
</div>
<div id="outline-container-org3f0942b" class="outline-4">
<h4 id="org3f0942b"><span class="section-number-4">7.2.8</span> Zookeeper</h4>
<div class="outline-text-4" id="text-7-2-8">
<p>
Zookeeper提供分布式锁功能，对SolrCloud是必须的。它处理Leader选举。Solr可以以内嵌的Zookeeper运行，但是建议用独立的，并且最好有3个以上的主机。 
</p>
</div>
</div>
</div>


<div id="outline-container-orgdfa5fcf" class="outline-3">
<h3 id="orgdfa5fcf"><span class="section-number-3">7.3</span> 配置外部 ZooKeeper</h3>
<div class="outline-text-3" id="text-7-3">
<p>
<b>需要多少Zookeeper</b> 想要挂掉F个机器时还能正常提供服务，就需要 2*F+1 台机器
下载地址： <a href="http://zookeeper.apache.org/releases.html">http://zookeeper.apache.org/releases.html</a>
</p>
</div>
<div id="outline-container-org511df27" class="outline-4">
<h4 id="org511df27"><span class="section-number-4">7.3.1</span> 一个实例</h4>
<div class="outline-text-4" id="text-7-3-1">
<ul class="org-ul">
<li>&lt;ZOOKEEPER_HOME&gt;/conf/zoo.cfg</li>
</ul>
<pre class="example">
# 一个滴答（时间单位， 毫秒）
tickTime=2000 
# 数据文件夹
dataDir=/var/lib/zookeeper
# 端口号
clientPort=2181
</pre>
</div>
</div>


<div id="outline-container-org1528651" class="outline-4">
<h4 id="org1528651"><span class="section-number-4">7.3.2</span> 集群</h4>
<div class="outline-text-4" id="text-7-3-2">
</div><ol class="org-ol"><li><a id="orgc9c0b05"></a>配置文件<br  /><div class="outline-text-5" id="text-7-3-2-1">
<ul class="org-ul">
<li><p>
zoo.cfg
</p>
<pre class="example">
dataDir=/var/lib/zookeeperdata/1
clientPort=2181
# 初始化连接最大忍受的滴答次数
initLimit=5
# leader 与 follower 发送消息最大的等待时间
syncLimit=2
# server.{第几号服务器}={ip地址}:{服务器与leader交换信息的端口}:{leader服务器挂掉之后，选举信息通信的端口}
server.1=localhost:2888:3888
server.2=localhost:2889:3889
server.3=localhost:2890:3890
</pre></li>

<li><p>
zoo2.cfg
</p>
<pre class="example">
tickTime=2000
dataDir=~/self/zoo/zoodata/2
clientPort=2182
initLimit=5
syncLimit=2
server.1=localhost:2888:3888
server.2=localhost:2889:3889
server.3=localhost:2890:3890
</pre></li>

<li><p>
zoo3.cfg
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682;">tickTime</span>=<span style="color: #e5786d;">2000</span>
<span style="color: #cae682;">dataDir</span>=~/self/zoo/zoodata/3
<span style="color: #cae682;">clientPort</span>=<span style="color: #e5786d;">2183</span>
<span style="color: #cae682;">initLimit</span>=<span style="color: #e5786d;">5</span>
<span style="color: #cae682;">syncLimit</span>=<span style="color: #e5786d;">2</span>
server.1=localhost:2888:3888
server.2=localhost:2889:3889
server.3=localhost:2890:3890
</pre>
</div></li>

<li><p>
myid file
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir -p zoodata/<span style="color: #8c8c8c;">{</span><span style="color: #e5786d;">1,2,3</span><span style="color: #8c8c8c;">}</span>
<span style="color: #e5786d;">echo</span> <span style="color: #e5786d;">1</span> &gt; <span style="color: #e5786d;">1/myid</span>
<span style="color: #e5786d;">echo</span> <span style="color: #e5786d;">2</span> &gt; <span style="color: #e5786d;">2/myid</span>
<span style="color: #e5786d;">echo</span> <span style="color: #e5786d;">3</span> &gt; <span style="color: #e5786d;">3/myid</span>
</pre>
</div></li>

<li>启动三个zookeeper</li>
</ul>
<p>
cd &lt;ZOOKEEPER_HOME&gt;
bin/zkServer.sh start zoo.cfg
bin/zkServer.sh start zoo2.cfg
bin/zkServer.sh start zoo3.cfg
</p>
<ul class="org-ul">
<li>引用外部zookeeper</li>
</ul>
<p>
bin/solr start -e cloud -z localhost:2181,localhost:2182,localhost:2183 -noprompt
</p>
<pre class="example">
➜  zoo bin/zkServer.sh status zoo.cfg
ZooKeeper JMX enabled by default
Using config: /Users/wudanyang/self/zoo/bin/../conf/zoo.cfg
Mode: follower
➜  zoo bin/zkServer.sh status zoo2.cfg
ZooKeeper JMX enabled by default
Using config: /Users/wudanyang/self/zoo/bin/../conf/zoo2.cfg
Mode: leader
➜  zoo bin/zkServer.sh status zoo3.cfg
ZooKeeper JMX enabled by default
Using config: /Users/wudanyang/self/zoo/bin/../conf/zoo3.cfg
Mode: follower
</pre>
</div></li></ol>
</div>



<div id="outline-container-org75fd3de" class="outline-4">
<h4 id="org75fd3de"><span class="section-number-4">7.3.3</span> 通过zookeeper管理配置文件</h4>
<div class="outline-text-4" id="text-7-3-3">
<p>
上传配置文件
sh zkcli.sh -cmd upconfig -zkhost &lt;host:port&gt; -confname &lt;name for configset&gt; -solrhome &lt;solrhome&gt; -confdir &lt;path to directory with configset&gt;
cd <i>Users/wudanyang/self/solr/server/scripts/cloud-scripts
sh zkcli.sh -cmd upconfig -zkhost localhost:2181 -confname yang -confdir ..</i>../../server/solr/configsets/basic_configs/conf
</p>
</div>
</div>


<div id="outline-container-org145975c" class="outline-4">
<h4 id="org145975c"><span class="section-number-4">7.3.4</span> 添加 node</h4>
<div class="outline-text-4" id="text-7-3-4">
<ul class="org-ul">
<li>zkServer.sh start *.cfg</li>
<li>bin/solr start -cloud -s &lt;conf path&gt; -p 8987 -z localhost:2181 # 添加一个节点,配置文件夹中必须包含一个solr.xml文件</li>
<li>bin/solr start -cloud -s confs/cloud/conf/ -p 8984 -z localhost:2181,localhost:2182,localhost:2183</li>
<li>zkServer.sh stop</li>
</ul>
</div>
</div>


<div id="outline-container-org23bedd8" class="outline-4">
<h4 id="org23bedd8"><span class="section-number-4">7.3.5</span> Collections API</h4>
<div class="outline-text-4" id="text-7-3-5">
<p>
创建多个shard需要多个node
nodeNum = shardNum * replicationFactorNum
</p>
<ul class="org-ul">
<li><a href="http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=yang&amp;numShards=1&amp;replicationFactor=3&amp;collection.configName=yang">http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=yang&amp;numShards=1&amp;replicationFactor=3&amp;collection.configName=yang</a></li>
<li><a href="http://localhost:8983/solr/admin/collections?action=RELOAD&amp;name=yang_test2">http://localhost:8983/solr/admin/collections?action=RELOAD&amp;name=yang_test2</a></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgd8aaee9" class="outline-3">
<h3 id="orgd8aaee9"><span class="section-number-3">7.4</span> Run Examples</h3>
<div class="outline-text-3" id="text-7-4">
</div><div id="outline-container-org8dd1dad" class="outline-4">
<h4 id="org8dd1dad"><span class="section-number-4">7.4.1</span> 通过 bin/solr restart 可以重启节点</h4>
<div class="outline-text-4" id="text-7-4-1">
<p>
bin/solr restart -c -p 8983 -s example/cloud/node1/solr
-c 启动solrcloud模式
-p 指定端口
-h 指定host
bin/solr restart -c -p 7574 -z localhost:9983 -s example/cloud/node2/solr
-z zookeeper服务器地址
</p>
</div>
</div>
<div id="outline-container-org8ebc343" class="outline-4">
<h4 id="org8ebc343"><span class="section-number-4">7.4.2</span> 向集群中添加一个节点</h4>
<div class="outline-text-4" id="text-7-4-2">
<p>
mkdir &lt;solr.home for new solr node&gt;
cp &lt;existing solr.xml path&gt; &lt;new solr.home&gt;
bin/solr start -cloud -s solr.home/solr -p &lt;port num&gt; -z &lt;zk hosts string&gt;
bin/solr start -cloud -s &lt;conf path&gt; -p 8987 -z localhost:2181 # 添加一个节点,配置文件夹中必须包含一个solr.xml文件
</p>

<p>
也可以通过以下命令,将solr.xml上传到zookeeper，这样就不用总是复制solr.xml到新的节点
zkcli.sh -zkhost localhost:2181 -cmd putfile /solr.xml /path/to/solr.xml
</p>
</div>

<ol class="org-ol"><li><a id="org63d59dd"></a>example<br  /><div class="outline-text-5" id="text-7-4-2-1">
<p>
mkdir -p example/cloud/node3/solr
cp server/solr/solr.xml example/cloud/node3/solr
第一次以cloud模式启动时会启动一个zookeeper服务器端口号是cloud端口号加上1000
bin/solr start -cloud -s example/cloud/node3/solr -p 8987 -z localhost:9983
</p>
</div></li></ol>
</div>
</div>
</div>
<div id="outline-container-orgbc9d535" class="outline-2">
<h2 id="orgbc9d535"><span class="section-number-2">8</span> Issues</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-org8fc5077" class="outline-3">
<h3 id="org8fc5077"><span class="section-number-3">8.1</span> 学习时遇到的问题</h3>
<div class="outline-text-3" id="text-8-1">
</div><div id="outline-container-orgad254c7" class="outline-4">
<h4 id="orgad254c7"><span class="section-number-4">8.1.1</span> Q: ZooKeeper JMX enabled by default Using config: <i>Users/wudanyang/self/zoo/bin</i>../conf/zoo.cfg Error contacting service. It is probably not running.</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
A: bin/zkServer.sh start-foreground 可以查看到
</p>
</div>
</div>

<div id="outline-container-org53ec5ed" class="outline-4">
<h4 id="org53ec5ed"><span class="section-number-4">8.1.2</span> Q: ZooKeeper 执行 bin/zkServer.sh status 说未启动</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
A: ps aux | grep zookeeper
查看是否存在
</p>
</div>
</div>

<div id="outline-container-orgfe8ea84" class="outline-4">
<h4 id="orgfe8ea84"><span class="section-number-4">8.1.3</span> Q: SolrCore Initialization Failures</h4>
<div class="outline-text-4" id="text-8-1-3">
<p>
A: 未上传配置
sh zkcli.sh -cmd upconfig -zkhost localhost:2181 -confname gettingstarted -confdir ../../../server/solr/configsets/basic_configs/conf
</p>
</div>
</div>


<div id="outline-container-org3560082" class="outline-4">
<h4 id="org3560082"><span class="section-number-4">8.1.4</span> Q: 通过api创建collection时, 返回localhost未返回任何数据</h4>
<div class="outline-text-4" id="text-8-1-4">
<p>
A: 请求地址应该是solr服务器，而不是zookeeper服务器。
localhost:8983/solr/admin/collectinos?action=CREATE&amp;name=yang&amp;numShards=1&amp;replicationFactor=3&amp;collection.configName=yang
</p>
</div>
</div>


<div id="outline-container-org27f7592" class="outline-4">
<h4 id="org27f7592"><span class="section-number-4">8.1.5</span> Q: Cannot create collection tinycollection. Value of maxShardsPerNode is 1, and the number of live nodes is 4. This allows a maximum of 4 to be created. Value of numShards is 2 and value of replicationFactor is 3. This requires 6 shards to be created (higher than the allowed number)&lt;/str&gt;</h4>
<div class="outline-text-4" id="text-8-1-5">
<p>
A:将replicationFactor降低
<a href="http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=yang&amp;collection.configName=yang&amp;numShards=1&amp;replicationFactor=1&amp;wt=json">http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=yang&amp;collection.configName=yang&amp;numShards=1&amp;replicationFactor=1&amp;wt=json</a>
</p>
</div>
</div>


<div id="outline-container-orgc42c125" class="outline-4">
<h4 id="orgc42c125"><span class="section-number-4">8.1.6</span> Q: 在zookeeper中找不到配置文件</h4>
<div class="outline-text-4" id="text-8-1-6">
<p>
A: 配置文件疑似在上传到zookeeper时放到了名为zoo_data/version-{num}/log.number的二进制文件中
</p>
</div>
</div>


<div id="outline-container-org9f556b4" class="outline-4">
<h4 id="org9f556b4"><span class="section-number-4">8.1.7</span> Q: 为何在6.*以上的solr中store=false 仍然能看到字段被返回了</h4>
<div class="outline-text-4" id="text-8-1-7">
<p>
A: 在6.*之后，string 的 docValues=true 为默认值
</p>
</div>
</div>


<div id="outline-container-orgf3cbae5" class="outline-4">
<h4 id="orgf3cbae5"><span class="section-number-4">8.1.8</span> Q: int类型为何docValues=false与stored=false还能在结果中看到字段</h4>
<div class="outline-text-4" id="text-8-1-8">
<p>
A: 未知
</p>
</div>
</div>


<div id="outline-container-org234a5a1" class="outline-4">
<h4 id="org234a5a1"><span class="section-number-4">8.1.9</span> Q: 从 example/example-DIH/solr/ 中复制solr.xml 作为cloud的配置文件无法生效</h4>
<div class="outline-text-4" id="text-8-1-9">
<p>
A: 因为默认的配置文件里面有 standalone="yes" 及不使用集群方式
</p>
</div>
</div>

<div id="outline-container-org725abc7" class="outline-4">
<h4 id="org725abc7"><span class="section-number-4">8.1.10</span> Q: 为什么找不到 Can't find resource 'schema.xml'</h4>
<div class="outline-text-4" id="text-8-1-10">
<p>
A: example 文件夹中的配置文件为 managed-schema 需要改成 schema.xml 上传才行
</p>
</div>
</div>
</div>


<div id="outline-container-orgcb38411" class="outline-3">
<h3 id="orgcb38411"><span class="section-number-3">8.2</span> 公司系统发现的问题</h3>
<div class="outline-text-3" id="text-8-2">
<ol class="org-ol">
<li>脚本文件处于无版本控制状态
创建git本地库，后续可以跟运维商量加上一个solr脚本的git库</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org95ef5d3" class="outline-2">
<h2 id="org95ef5d3"><span class="section-number-2">9</span> Cache</h2>
<div class="outline-text-2" id="text-9">
<p>
缓存在 Solr 中充当了一个非常重要的角色，Solr 中主要有这三种缓存：
</p>
<ol class="org-ol">
<li>Filter cache（过滤器缓存），用于保存过滤器（fq 参数）和层面搜索的结果</li>
<li>Document cache（文档缓存），用于保存 lucene 文档存储的字段</li>
<li>Query result（查询缓存），用于保存查询的结果</li>
<li>还有第四种缓存，lucene 内部的缓存，不过该缓存外部无法控制到。</li>
</ol>

<p>
通过这 3 种缓存，可以对 solr 的搜索实例进行调优。调整这些缓存，需要根据索引库中文档的数量，每次查询结果的条数等。
在调整参数前，需要事先得到 solr 示例中的以下信息： 索引中文档的数量 每秒钟搜索的次数 过滤器的数量 一次查询返回最大的文档数量
不同查询和不同排序的个数，这些数量可以在 solr admin 页面的日志模块找到。
</p>

<p>
假设以上的值分别为：
索引中文档的数量：1000000
每秒钟搜索的次数：100
过滤器的数量：200
一次查询返回最大的文档数量：100
不同查询和不同排序的个数：500
然后可以开始修改 solrconfig.xml 中缓存的配置了，
</p>



<p>
第一个是过滤器缓存：
第二个是查询结果缓存：
第三个是文档缓存：
这几个配置是基于以上的几个假设的值进行调优的。
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
正排索引是指由文档找词，倒排索引是指由词找文档
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: 吴丹阳</p>
<p class="date">Created: 2017-01-03 二 12:01</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
